# 网络认证助手

一个用于自动进行网络认证的工具，支持在线和离线模式，适用于各大高校校园网。

## 功能特点

- 自动检测网络连接状态
- 自动重连网络
- 账号信息加密存储
- 支持快速反馈功能
- 支持在线和离线模式
- 全平台支持（可根据需要适配）

## 安装依赖

```bash
pip install requests tkinter
```

## 客户端使用方法

### 在线模式

1. 运行 `client-online.py` 启动在线模式
2. 首次运行时会提示录入账号信息
3. 点击【开始认证】启动后台检测
4. 程序会自动检测网络状态并在需要时重连

### 离线模式

1. 运行 `client-offline.py` 启动离线模式
2. 首次运行时会提示录入账号信息
3. 点击【开始认证】启动后台检测
4. 程序会在离线状态下运行，不依赖服务器

## 服务端使用方法

### 服务端功能

- 接收客户端的心跳包
- 提供在线人数统计
- 提供广告/通知功能
- 提供版本更新检查
- 接收用户反馈

### 服务端配置

1. 确保服务端运行在校园网内网环境中
2. 配置服务端IP地址到客户端的 `SER_IP` 参数中
3. 启动服务端程序 `server.py`

## 如何适配自己的环境

基于 [各大高校都适用的 全平台校园网自动登录实现方法](https://www.bilibili.com/read/cv16042718/?opus_fallback=1)，您可以按照以下步骤适配自己的校园网环境：

### 第0步：检查适配性

1. 在电脑上输入校园网登录IP，用浏览器打开校园网的登录页面
2. 按F12打开开发人员工具，切换到网络(Network)页面，将保留日志(Preserve log)勾上
3. 输入账号、密码(、选择运营商)，登录
4. 在开发人员工具中，寻找相关资源文件(一般是第一个)，单击这个文件
5. 切换到标头(Headers)，查看请求的URL(Request URL)后面的文本中：
   - 是否出现了自己的账号和密码
   - 复制请求的URL到浏览器地址栏，回车，检查是否能够访问互联网

如果上述条件满足，那么您学校的校园网可以通过本方法登录。

### 第1步：获取登录参数

1. 手动退出校园网的登录，回到登录界面
2. 按下F12，打开开发人员工具，点击"切换设备仿真"
3. 修改"尺寸"，选择任意移动设备，比如S20 Ultra，刷新页面
4. 切换到"网络"页面，输入登录信息，登录校园网
5. 找到刚刚的那条资源，复制完整的请求URL
6. 记录请求方法(一般为GET或POST)

### 第2步：配置客户端

在 `client-online.py` 文件中，根据获取的信息配置以下参数：

```python
# 服务器配置
SER_IP = ""  # 服务器IP地址
VER = ""     # 版本号

# 网络配置
url_chk = ""  # 网络状态检查URL
url_login = ""  # 登录认证URL
```

其中：
- `url_login` 应设置为您复制的登录请求URL，但需要将账号密码部分替换为占位符
- `url_chk` 应设置为校园网状态检查的URL（可通过类似方法获取）

### 第3步：测试连接

1. 运行客户端程序
2. 录入账号信息
3. 点击【开始认证】启动后台检测
4. 观察日志输出，确认网络连接正常

## 配置说明

### 客户端配置

#### 在线模式配置

| 参数 | 说明 | 示例值 |
|------|------|--------|
| SER_IP | 服务器IP地址 | "192.168.1.100" |
| VER | 版本号 | "V1.0" |
| url_chk | 网络状态检查URL | "http://192.168.1.1/drcom/chkstatus?callback=dr1002&v=7752" |
| url_login | 登录认证URL | "http://192.168.1.1/drcom/login?callback=dr1003&DDDDD={username}&upass={password}&0MKKey=123456" |

#### 离线模式配置

离线模式不需要额外配置，当无法连接到服务器时会自动切换到离线模式。

### 服务端配置

服务端配置应根据实际部署环境进行调整，主要包括：

- 监听端口
- 数据库连接（如果需要）
- 广告/通知内容
- 版本信息

## 文件说明

- `client-online.py` - 在线模式主程序
- `client-offline.py` - 离线模式主程序
- `server.py` - 服务端主程序
- `comfig.yml` - 账号信息加密存储文件

## 注意事项

- 本程序仅供个人学习和参考，请勿用做其他用途
- 账号信息会被加密存储在本地
- 请确保输入正确的网络配置信息
- 部分学校的校园网可能会对登录设备进行限制，请根据实际情况调整
- 若校园网登录方式发生变化，可能需要重新适配

## 常见问题

### 无法登录校园网

1. 检查网络配置是否正确
2. 确认校园网登录URL是否发生变化
3. 检查账号密码是否正确
4. 尝试使用浏览器手动登录，确认校园网是否正常

### 频繁掉线

1. 检查网络连接是否稳定
2. 确认校园网是否有时间限制
3. 尝试调整心跳间隔

### 服务端无法连接

1. 检查服务端是否正常运行
2. 确认客户端配置的服务器IP地址是否正确
3. 检查网络防火墙是否阻止了连接

## 许可证

MIT

## 免责声明

本程序仅供个人学习和参考，使用本程序所产生的一切后果由使用者自行承担。
